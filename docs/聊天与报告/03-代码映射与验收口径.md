# yourConnector 聊天与报告：代码映射与验收口径

## 1. 代码映射

1. 会话键与状态结构：`app/mobile/ui/js/state/chat.js`
2. 聊天流程编排：`app/mobile/ui/js/flows/chat.js`
3. 聊天 UI 渲染：`app/mobile/ui/js/views/chat.js`
4. 报告弹窗：`app/mobile/ui/js/modals/report-viewer.js`
5. 聊天/会话本地存储：`app/mobile/src-tauri/src/lib.rs`
6. 聊天执行器：`services/sidecar/src/session/loop/chat.rs`
7. 报告执行器：`services/sidecar/src/session/loop/report.rs`
8. 命令入站与回执：`services/sidecar/src/session/loop/command.rs`

## 2. 验收清单（聊天与报告域）

1. 会话列表可进入详情页与完整消息页。
2. 会话在线时可连续发送，超出 20 条队列会收到上限提示。
3. 运行中可发送取消请求，最终状态正确收敛。
4. Sidecar 并发冲突会回 `busy`，App 不会卡死会话。
5. 报告路径点击可触发请求并展示分片进度。
6. 非绝对路径或非 `.md` 路径会被明确拒绝。
7. 报告失败时弹窗显示错误，不误判为成功。
8. 关闭并重开 App 后，历史会话可从本地索引恢复。

## 3. 联调建议

```bash
# 启动服务
make run-relay
make run-sidecar

# 启动移动端
make run-mobile-tauri-ios IOS_SIM="iPhone 17 Pro"

# 查看配对深链
make show-pairing-link
```

## 4. 与其他文档关系

1. 运维页与工具接入见 `docs/运维与工具管理/`。
2. 工具详情 schema 与采集见 `docs/工具详情与数据采集/`。
3. 协议字段全集见 `docs/API与事件协议.md`。
