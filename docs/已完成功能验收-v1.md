# yourConnector 已完成功能验收 v1

## 1. 验收目标

确认当前版本在“配对 + 多宿主管理 + 运维展示”场景下可稳定使用，作为后续演进基线。

## 2. 验收范围

1. Relay / Sidecar / Mobile 基础链路
2. 配对三入口（扫码/图库、粘贴链接、手动配对信息）
3. 配对后设备凭证换发（`accessToken + refreshToken`）
4. 多宿主 Banner 总览与白点索引
5. Tools 按宿主机分组展示
6. 并行在线、重连上限、手动重连
7. 删除补偿队列与最终一致性删除
8. relay 统一配对签发（`/v1/pair/bootstrap`）与脚本/sidecar 一致性

## 3. 启动步骤

### 3.1 启动 Relay 与 Sidecar

```bash
cd /Users/codez/develop/yourConnector
make run-relay
make run-sidecar
```

健康检查（建议）：

```bash
curl -sS http://127.0.0.1:18080/healthz
curl -sS http://127.0.0.1:18081/healthz
```

### 3.2 启动 iOS App

```bash
cd /Users/codez/develop/yourConnector
make run-mobile-tauri-ios IOS_SIM="iPhone 17 Pro"
```

准备配对信息（任选其一）：

```bash
make show-pairing
make show-pairing-link
make simulate-ios-scan
```

### 3.3 执行配对

在 App 内任选入口完成配对：

1. 导入链接（粘贴 `yc://pair?...`）
2. 扫码/图库
3. 手动输入 `Relay WS URL + sid + ticket`

## 4. 验收项

### 4.1 页面与展示

1. A01 无宿主机时展示配对页。
2. A02 有宿主机时展示 Banner 总览页。
3. A03 Banner 下方白点索引随滑动更新。
4. A04 Banner 卡片仅展示宿主机名称与在线状态。
5. A05 Tools 按宿主机分组显示。
6. A06 分组顺序按认证时间升序。
7. A06-1 已接入工具支持左滑显示“编辑/删除”操作。

### 4.2 连接行为

1. A07 启动后自动连接宿主机。
2. A08 手动断开后自动按 2 秒重连。
3. A09 连续失败 5 次后提示手动重连。
4. A10 手动重连后可恢复在线。

### 4.3 配对与命名

1. A11 四条配对路径均可触发配对。
2. A12 配对失败统一弹窗显示“原因 + 建议 + 主按钮”。
3. A13 宿主机名称重名时弹出改名引导，不影响连接。
4. A13-1 旧 `pairToken` 配对参数会被明确拒绝（`PAIR_TOKEN_NOT_SUPPORTED`）。

### 4.4 删除补偿

1. A14 Relay 可达时删除宿主机立即完成。
2. A15 Relay 不可达时宿主机先隐藏并进入删除补偿队列。
3. A16 管理页可查看“删除处理中”并手动重试。
4. A17 Relay 恢复后补偿成功并最终删除。

### 4.5 安全边界

1. A18 localStorage 不含 `pairToken/accessToken/refreshToken`。
2. A19 Keychain 可恢复设备会话并用于重连。

### 4.6 配对签发一致性

1. A20 `make show-pairing-link` 可返回 relay 签发的 `yc://pair` 链接。
2. A21 sidecar 启动后展示的 `sid/relay/hostName` 与脚本输出一致。
3. A22 `make simulate-ios-scan` 可直接触发 App 导入并完成配对。

## 5. 验收记录

1. 验收日期：`待填写`
2. 验收人：`待填写`
3. 结论：`待填写（通过 / 有条件通过 / 不通过）`

## 6. 当前说明

1. 多宿主真实联调待接入第二台宿主机后执行手工验收。
2. 自动化回归在后续迭代补齐。
