# yourConnector 代码治理与注释规范

## 1. 适用范围

1. 业务源码目录：
   - `app/mobile/ui/js`
   - `app/mobile/src-tauri/src`
   - `services/relay/src`
   - `services/sidecar/src`
   - `protocol/rust/src`
2. 不强制目录：`scripts`、测试函数与测试模块。

## 2. 文件头注释规范

1. 每个业务源码文件首段必须有中文职责注释。
2. 文件头至少说明三点：
   - 该文件负责什么。
   - 该文件不负责什么。
   - 该文件依赖边界（调用上游/下游模块）。

## 3. 函数头注释规范

1. JS：所有 `export function` 必须带 JSDoc 注释。
2. Rust：所有业务函数必须带 `///` 注释。
3. 注释内容最少覆盖：
   - 函数用途。
   - 关键输入约束或失败语义。
   - 关键副作用（例如持久化、网络发送、状态修改）。

## 4. 行内注释规范

1. 只给“不直观但关键”的逻辑写行内注释。
2. 必须注释的典型场景：
   - 鉴权分支与拒绝条件。
   - nonce 防重放与时间窗处理。
   - 重试终态（例如 2 秒重连、5 次上限）。
   - 删除补偿收口（终态/可重试/跳过）。
3. 避免无信息注释（例如“给变量赋值”）。

## 5. 可读性规范

1. 业务源码目标行长 `<=120`；当前硬门槛 `<=140`。
2. 超长表达式必须拆行，优先拆：
   - 模板字符串。
   - 多条件布尔表达式。
   - 大对象字面量。
3. 复杂函数内部优先提取小函数，避免一行承载多个职责。

## 6. 架构边界规范

1. `services/*` 不直接访问 DOM。
2. `views/*` 只负责渲染，不承载状态策略。
3. `state/*` 只负责状态与持久化，不编排流程。
4. `flows/*` 负责流程编排，不维护全局 DOM 常量映射。

## 7. 文档命名规范

1. `docs` 目录采用单版本滚动维护，不新增 `v1/v2` 后缀文档。
2. 历史方案如需保留，写入同一文档的“历史决策”章节，不分叉文件。

## 8. 违规处理

1. 任何违反本规范的提交必须被门禁阻断。
2. 允许紧急修复先过功能，但不得绕过门禁合入主干。
