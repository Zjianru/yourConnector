# yourConnector 工具详情与数据采集：能力总览与代码边界

## 1. 文档目标

1. 说明工具详情链路在当前版本的职责边界。
2. 明确“发现 -> 快照 -> 详情采集 -> UI 渲染”全链路代码对应。
3. 约束后续新增工具适配器时的兼容面。

## 2. 能力范围

当前版本支持：

1. 工具发现：OpenClaw、OpenCode。
2. 快照输出：`tools_snapshot` `tools_candidates` `metrics_snapshot`。
3. 详情输出：`tool_details_snapshot`。
4. 详情 schema：`openclaw.v1`、`opencode.v1`。
5. 详情降级：采集失败时 `stale=true` 且保留上次成功数据。

## 3. 核心组件边界

服务端采集与缓存：

1. `services/sidecar/src/tooling/core/mod.rs`
2. `services/sidecar/src/tooling/core/scheduler.rs`
3. `services/sidecar/src/tooling/core/cache.rs`
4. `services/sidecar/src/tooling/adapters/openclaw.rs`
5. `services/sidecar/src/tooling/adapters/opencode.rs`
6. `services/sidecar/src/session/snapshots.rs`
7. `services/sidecar/src/session/loop/mod.rs`

移动端渲染：

1. `app/mobile/ui/js/modals/tool-detail.js`
2. `app/mobile/ui/js/state/runtime.js`
3. `app/mobile/ui/js/flows/connection-events.js`

## 4. 关键运行参数

1. 详情周期：`DETAILS_INTERVAL_SEC`，默认 `45`。
2. 详情去抖：`DETAILS_REFRESH_DEBOUNCE_SEC`，默认 `3`。
3. 命令超时：`DETAILS_COMMAND_TIMEOUT_MS`，默认 `8000`。
4. 并发上限：`DETAILS_MAX_PARALLEL`，默认 `2`。
5. 详情 TTL：`details_interval * 2`。

## 5. 兼容与约束

1. UI 以 `schema` 决定渲染分支，不允许靠 `toolId` 硬编码分支。
2. 详情缺失时仍允许展示快照卡片，避免“点击空白弹窗”。
3. 采集失败必须返回可读 `collectError`，不返回静默失败。
