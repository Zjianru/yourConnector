# yourConnector 里程碑与待办 v1

## 1. 状态标签

- `ACCEPTED`：已完成并通过当前验收基线
- `IN_PROGRESS`：已启动开发，尚未完成验收
- `TODO`：未启动
- `BLOCKED`：受外部条件阻塞

## 2. 已验收里程碑（当前基线）

### M1 基础通信链路（`ACCEPTED`）

- Relay / Sidecar / Mobile（Tauri iOS）可连通
- Mobile 可发送事件，sidecar 可接收并回传
- Relay 可按 `systemId` 路由

### M2 身份与配对安全基线（`ACCEPTED`）

- Sidecar 本机持久化生成 `systemId` 与 `pairToken`
- Sidecar 启动输出 `pairing_code`（`systemId.pairToken`）
- Mobile 通过 `yc://pair(sid+ticket)` 或 `Relay + sid + ticket` 完成配对
- Relay 采用双轨鉴权：sidecar 使用 `pairToken`，App 使用 `accessToken + PoP`
- relay 新增 `/v1/pair/bootstrap`，sidecar 与脚本统一走 relay 签发配对链接

### M2.1 代码模块化收敛（`ACCEPTED`）

- relay 进一步深拆为 `auth/handlers/*`、`pairing/handlers/*`、`ws/handlers/*`
- sidecar 进一步深拆为 `session/loop/*`、`tooling/opencode_session/*`
- mobile 入口瘦身，业务逻辑下沉到 `flows/state/views/modals/services` 子模块
- 代码门禁通过：`cargo fmt --check`、`cargo clippy -D warnings`、`cargo test --workspace`、`node --check`

### M3 工具发现与接入（`ACCEPTED`）

- 自动发现 OpenCode / OpenClaw 进程
- Tools 页面区分 `Connected` 与 `Candidates`
- 支持候选工具接入（白名单）
- 支持断开（移出白名单）
- 支持“绑定当前设备为控制端”（重绑控制设备）

### M4 运维基础视图（`ACCEPTED`）

- Host Snapshot 展示 CPU / Memory / Disk / Uptime
- Memory / Disk 展示百分比 + GB 用量
- OpenCode 详情支持摘要 + 展开/收起
- 模型、Token、会话信息可在详情中查看

## 3. 当前迭代边界（冻结）

当前迭代仅处理两类工作：

1. 已完成功能的缺陷修复（稳定性、准确性、交互一致性）
2. 已完成功能的演进优化（不引入全新产品域）

本迭代暂不进入以下新域：

- 终端 PTY 全交互
- 聊天/任务 ACK 与断线续流协议完整实现
- 云端账号体系、好友体系
- 附件/文件流

## 4. 待办里程碑（后续）

### M4.1 配对即添加宿主机（`ACCEPTED`）

- 目标：将“添加宿主机”与“连接宿主机”合并为“配对宿主机”单流程
- 交付：
  - Tools 首屏三态（未配对 / 已配对未连接 / 已连接）
  - 顶部宿主机连接管理（连接、断开、更换）
  - 扫码/链接配对入口（保留手工 `Relay + sid + ticket` 兜底）
  - sidecar / relay 启动高亮展示配对入口（配对码 + 配对链接）
  - iOS 模拟器 `simctl openurl` 扫码模拟链路
  - relay 短时配对票据（`pairTicket`）校验与防重放（App 不再接受 `pairToken`）
  - relay 配对预检接口（`/v1/pair/preflight`）与统一错误码
  - 配对后设备凭证换发（`/v1/pair/exchange`）
  - access/refresh 凭证刷新与设备吊销接口
  - WS 支持 `accessToken + keyId + ts + nonce + sig` 的 PoP 鉴权
  - 配对安全与协议演进设计文档
- 设计文档目录：
  - `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/00-设计总览与决策-v1.md`
  - `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/01-用户流程与页面交互-v1.md`
  - `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/02-协议与安全方案-v1.md`
  - `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/03-实施计划与验收-v1.md`

### M5 运维命令执行器（`TODO`）

- 建立命令白名单执行框架
- 支持工具级运维命令（如重启、状态采集）
- 输出结构化执行结果与错误码

### M6 终端交互闭环（`TODO`）

- `terminal_open / input / resize / output` 最小闭环
- 移动端终端按钮进入交互界面
- 支持中断与基础控制键映射

### M7 可靠性与协议补全（`TODO`）

- `seq/ack` 与断线恢复
- 幂等处理与重复包去重
- 重连后的状态重建

### M8 云部署基线（`TODO`）

- Relay 云端部署（TLS、反向代理、日志轮转）
- 配置模板与运维脚本
- 最小安全加固（限流、连接配额、审计日志）

## 5. 执行顺序建议

1. 先完成当前迭代内缺陷清理与体验修正
2. 再进入 M5（命令执行器）
3. 然后进入 M6（终端交互）
4. 最后补 M7/M8（协议与云部署）
