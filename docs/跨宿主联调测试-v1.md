# yourConnector 跨宿主联调测试 v1

## 1. 测试目标

1. 验证 A 机（Linux 云主机）relay + sidecar 两步安装与守护运行。
2. 验证 B 机（本地 Mac mini）sidecar 可接入 A 机 relay。
3. 验证 iOS 模拟器完成配对并展示宿主机与工具状态。

## 2. 前置条件

1. A 机具备稳定公网 IPv4，开放 80/443。
2. B 机可运行 sidecar 安装脚本。
3. 你已从 Release 或 OSS 获取：
   - `yc-relay.sh`
   - `yc-sidecar.sh`

## 3. A 机操作

```bash
# 先安装 relay
sudo ./yc-relay.sh install \
  --acme-email you@example.com \
  --public-ip <A公网IPv4> \
  --yes

# 再安装 sidecar
sudo ./yc-sidecar.sh install \
  --relay-ip <A公网IPv4> \
  --yes
```

验证：

```bash
sudo ./yc-relay.sh status
sudo ./yc-relay.sh doctor --format json
sudo ./yc-sidecar.sh status
sudo ./yc-sidecar.sh doctor --format json
```

## 4. B 机操作（Mac）

```bash
sudo ./yc-sidecar.sh install \
  --relay-ip <A公网IPv4> \
  --yes
```

验证：

```bash
sudo ./yc-sidecar.sh status
sudo ./yc-sidecar.sh doctor --format json
yc-sidecar relay
```

## 5. iOS 模拟器联调

```bash
make run-mobile-tauri-ios IOS_SIM="iPhone 17 Pro"
```

1. 在 mobile 中添加宿主机。
2. 使用 `yc-sidecar pairing show --format link` 提供配对链接。
3. 配对成功后检查：
   - Host Snapshot 在线状态
   - Connected Tools 分组展示
   - 工具详情可刷新

## 6. 回滚与重测

```bash
# A机彻底清理
sudo ./yc-sidecar.sh uninstall --yes
sudo ./yc-relay.sh uninstall --yes

# B机彻底清理
sudo ./yc-sidecar.sh uninstall --yes
```

如需保留配置与身份，改用：

```bash
sudo ./yc-sidecar.sh uninstall --keep-data --yes
sudo ./yc-relay.sh uninstall --keep-data --yes
```
