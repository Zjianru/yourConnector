# yourConnector 跨宿主联调测试

## 1. 测试目标

1. 验证 A 机（Linux 云主机）Relay + Sidecar 两步安装与守护运行。
2. 验证 B 机（本地 Mac）Sidecar 可接入 A 机 Relay。
3. 验证 iOS 模拟器完成配对、工具接入、聊天与报告链路。

## 2. 前置条件

1. A 机具备稳定公网 IPv4，开放 80/443。
2. B 机可运行 Sidecar 安装脚本。
3. 已获取发布脚本：`yc-relay.sh`、`yc-sidecar.sh`。

## 3. A 机操作

```bash
# 先安装 Relay
sudo ./yc-relay.sh install \
  --acme-email you@example.com \
  --public-ip <A公网IPv4> \
  --yes

# 再安装 Sidecar
sudo ./yc-sidecar.sh install \
  --relay-ip <A公网IPv4> \
  --yes
```

验证：

```bash
sudo ./yc-relay.sh status
sudo ./yc-relay.sh doctor --format json
sudo ./yc-sidecar.sh status
sudo ./yc-sidecar.sh doctor --format json
```

## 4. B 机操作

```bash
sudo ./yc-sidecar.sh install \
  --relay-ip <A公网IPv4> \
  --yes
```

验证：

```bash
sudo ./yc-sidecar.sh status
sudo ./yc-sidecar.sh doctor --format json
yc-sidecar relay
```

## 5. iOS 模拟器联调

```bash
cd yourConnector
make run-mobile-tauri-ios IOS_SIM="iPhone 17 Pro"
```

### 5.1 配对链路

1. 使用 `make show-pairing-link` 获取 `yc://pair` 链接。
2. 在移动端导入链接或执行 `make simulate-ios-scan`。
3. 确认宿主机成功入列并自动连接。

### 5.2 工具链路

1. 确认 `Connected Tools` 按宿主机分组展示。
2. 打开工具详情，确认 `tool_details_snapshot` 到达并有数据。
3. 验证工具接入/断开与进程控制回执。

### 5.3 聊天与报告链路

1. 在聊天页向已接入工具发送消息。
2. 确认收到 `tool_chat_started/chunk/finished`。
3. 点击报告路径，确认报告弹窗展示进度与 Markdown 内容。

## 6. 回滚与重测

```bash
# A机清理
sudo ./yc-sidecar.sh uninstall --yes
sudo ./yc-relay.sh uninstall --yes

# B机清理
sudo ./yc-sidecar.sh uninstall --yes
```

如需保留配置与身份：

```bash
sudo ./yc-sidecar.sh uninstall --keep-data --yes
sudo ./yc-relay.sh uninstall --keep-data --yes
```
