# yourConnector 已完成功能验收

> 本文档是当前唯一执行型验收清单。功能状态以“代码可验证 + 手工可复现”为准。

## 1. 验收目标

确认当前版本在以下场景可稳定运行：

1. 配对与多宿主接入。
2. 工具接入、详情查看与进程控制。
3. 聊天执行与报告拉取。
4. 日志归档与结构化追踪。

## 2. 验收范围

1. Relay / Sidecar / Mobile 基础链路。
2. 配对三入口（扫码/图库、链接导入、手动输入）。
3. 凭证换发与刷新（`pairTicket -> access/refresh + PoP`）。
4. 多宿主 Banner、白点索引、分组工具视图。
5. 工具详情链路（`openclaw.v1` / `opencode.v1`）。
6. 聊天链路（`tool_chat_*`）。
7. 报告链路（`tool_report_fetch_*`）。
8. 安装脚本与服务命令口径。
9. 系统日志落盘、归档、追踪字段。

## 3. 启动步骤

### 3.1 服务启动

```bash
cd yourConnector
make run-relay
make run-sidecar
```

健康检查：

```bash
curl -sS http://127.0.0.1:18080/healthz
curl -sS http://127.0.0.1:18081/healthz
```

### 3.2 iOS 启动

```bash
cd yourConnector
make run-mobile-tauri-ios IOS_SIM="iPhone 17 Pro"
```

### 3.3 配对辅助

```bash
make show-pairing
make show-pairing-link
make simulate-ios-scan
```

## 4. 验收项

### 4.1 代码门禁

1. G01 `cargo fmt --check` 通过。
2. G02 `cargo clippy --workspace --all-targets -- -D warnings` 通过。
3. G03 `cargo test --workspace` 通过。
4. G04 JS 语法检查通过（`node --check` + ESM）。
5. G05 `make check-governance` 通过。

### 4.2 页面与连接

1. A01 无宿主机时展示配对入口页。
2. A02 有宿主机时展示 Banner 总览页。
3. A03 Banner 白点索引随滑动更新。
4. A04 工具按宿主机分组显示。
5. A05 启动后自动连接宿主机。
6. A06 断开后按固定策略自动重连，超限提示手动重连。

### 4.3 配对与安全

1. A07 链接导入、扫码/图库、手动输入均可触发配对。
2. A08 配对失败统一弹窗展示“原因 + 建议 + 主动作”。
3. A09 `pairToken` App 直连被拒绝（`PAIR_TOKEN_NOT_SUPPORTED`）。
4. A10 `preflight -> exchange` 成功后可恢复会话。
5. A11 `localStorage` 不落地 `pairToken/accessToken/refreshToken`。
6. A12 Keychain/安全存储可恢复设备会话并用于重连。

### 4.4 工具接入与详情

1. A13 候选工具可接入（加入白名单后进入 connected）。
2. A14 已接入工具支持左滑操作（改名/删除）。
3. A15 详情打开时会发送 `tool_details_refresh_request`。
4. A16 sidecar 可返回 `tool_details_snapshot` 且按 `toolId` 对齐。
5. A17 `OpenClaw` 详情可展示五屏与 Sessions 三分段。
6. A18 `OpenCode` 详情可展示会话、模型与 token 用量。
7. A19 详情采集失败时保留旧值并标记 `stale`。
8. A20 工具进程控制回执可展示（`tool_process_control_updated`）。

### 4.5 聊天与报告

1. A21 聊天请求可发送并收到 `tool_chat_started/chunk/finished`。
2. A22 单会话重复提交时，队列与状态管理正确。
3. A23 取消请求后可收到结束回执并释放运行态。
4. A24 报告请求可发送并收到 `tool_report_fetch_started/chunk/finished`。
5. A25 报告仅允许读取工作区内绝对路径 `.md` 文件。
6. A26 报告内容可在移动端弹窗中按 Markdown 渲染。

### 4.6 日志与追踪

1. A27 启动后 `logs/raw` 出现当日日志文件。
2. A28 历史日志会归档到 `logs/archive/YYYY-MM-DD.7z`。
3. A29 归档成功后对应 `raw` 历史文件被删除。
4. A30 relay/sidecar 日志包含 `event_id/trace_id` 摘要字段。
5. A31 移动端调试页支持复制结构化日志 JSON。

### 4.7 安装与发布口径

1. A32 `yc-relay.sh` / `yc-sidecar.sh` 仅含服务命令，不含 `run`。
2. A33 `yc-sidecar.sh install --relay-ip` 自动拼接 `wss://<ip>/v1/ws`。
3. A34 `yc-relay status/doctor/service/version` 可用。
4. A35 `yc-sidecar status/doctor/service/version` 可用并保留 `relay/pairing` 子命令。

## 5. 验收记录

1. 最近一次人工全量验收日期：`未执行（截至 2026-02-26）`。
2. 验收人：`未指定`。
3. 结论：`未执行人工全量验收，当前仅完成代码与文档一致性复检`。

## 6. 备注

1. 本文档维护“执行口径”，不等同于发布说明。
2. 若与其他文档冲突，以本文档为准并回改来源文档。
