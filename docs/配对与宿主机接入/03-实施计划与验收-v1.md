# yourConnector 配对与宿主机接入：实施记录与验收引用 v1

## 1. 文档定位

1. 本文档仅记录“已执行实施阶段与落地结果”。
2. 当前唯一验收执行文档为：
   `/Users/codez/develop/yourConnector/docs/已完成功能验收-v1.md`
3. 若本文与验收文档描述冲突，以验收文档为准。

## 2. 已完成实施阶段（历史记录）

### 2.1 配对链路收口

1. Relay 提供 `/v1/pair/bootstrap`，作为配对链接唯一签发源。
2. Sidecar 与 `scripts/pairing.sh` 统一改为调用 Relay 签发。
3. App 侧配对与 WS 握手拒绝 `pairToken` 直连，改为 `ticket + 设备凭证` 主链路。

### 2.2 多宿主与运维页

1. 首屏三态：无宿主机配对页 / 已配对总览页 / 已连接状态。
2. 总览页采用 Banner + 白点索引，工具按宿主机分组展示。
3. 宿主管理支持编辑、断开、重新配对、删除。

### 2.3 连接稳定性

1. 宿主机并行在线。
2. 心跳驱动在线状态更新。
3. 断线后固定 2 秒重连，连续失败 5 次后转手动重连。

### 2.4 删除最终一致性补偿

1. 删除动作采用“先隐藏，再补偿”。
2. Relay 不可达或鉴权失败时进入补偿队列。
3. Relay 恢复后自动重试吊销并清理本地会话。

## 3. 与当前代码的映射

1. Mobile 流程层：
   `/Users/codez/develop/yourConnector/app/mobile/ui/js/flows/*`
2. Relay 配对与鉴权：
   `/Users/codez/develop/yourConnector/services/relay/src/pairing/*`
   `/Users/codez/develop/yourConnector/services/relay/src/auth/*`
   `/Users/codez/develop/yourConnector/services/relay/src/ws/*`
3. Sidecar 会话与工具发现：
   `/Users/codez/develop/yourConnector/services/sidecar/src/session/*`
   `/Users/codez/develop/yourConnector/services/sidecar/src/discoverers/*`

## 4. 当前状态引用

1. 验收执行：`/Users/codez/develop/yourConnector/docs/已完成功能验收-v1.md`
2. 里程碑状态：`/Users/codez/develop/yourConnector/docs/里程碑与待办-v1.md`
3. 协议与安全：`/Users/codez/develop/yourConnector/docs/配对与宿主机接入/02-协议与安全方案-v1.md`
