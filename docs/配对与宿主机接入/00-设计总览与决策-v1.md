# yourConnector 配对与宿主机接入：设计总览与决策 v1

## 1. 背景

当前链路已经可用，但存在明显体验割裂：

1. 粘贴配对链接后，用户还需要额外点击“导入配对链接”才能生效，主按钮语义不一致。
2. 配对入口混在一个页面内，扫码、粘贴链接、手动配对码的心智不清晰。
3. 配对失败提示不统一，用户无法快速知道下一步动作。

## 2. 本轮决策

### 2.1 是否要重设配对方案

结论：**要重设交互方案，但不推翻协议层**。

1. 交互层重构：按“配对宿主机主页面 + 导入配对链接独立页面 + 统一失败弹窗”重做。
2. 协议层兼容：继续支持 `pairToken`，并保留 `pairTicket` 作为安全增强，不做破坏性切换。

### 2.2 配对是否有必要

结论：**有必要**（在使用 Relay 的前提下）。

1. 配对解决“哪台手机有权控制哪台宿主机”。
2. 没有配对，知道 Relay 地址的客户端可尝试接入。
3. 配对是最小安全基线，不是可选体验功能。

### 2.3 短时票据的定位

结论：**短时票据是安全增强层，不应伤害首次成功率**。

1. `pairTicket` 用于缩短二维码泄露风险窗口并支持防重放。
2. 若票据过期或校验失败，应有可解释错误并允许回退可用路径。
3. 配对体验优先级高于“纯净协议理想态”，MVP 阶段坚持可用第一。

## 3. 交互目标（本轮）

本轮统一目标：**配对即添加宿主机，且路径单义、反馈清晰**。

1. Tools 首屏只负责“开始配对”，不直接承载复杂导入细节。
2. “导入配对链接”作为独立页面，承载扫码/相册识别/粘贴链接两种入口。
3. 手动配对码作为并行兜底页面保留。
4. 任一入口配对失败，都走统一失败弹窗（原因 + 建议下一步）。

## 4. 设计原则

1. 单任务单页面：一个页面只做一件事，避免并列输入引发混淆。
2. 主按钮语义一致：用户点击“配对并连接”时必须真实触发配对动作。
3. 失败可恢复：任何失败都要给出可执行下一步，而不是只报错。
4. 安全渐进升级：先兼容、再收紧，避免一次性切换导致可用性回退。
5. 宿主机优先展示：sidecar/relay 任一先启动，都应高亮展示配对入口（配对码/配对链接/二维码）。

## 5. 分阶段落地

1. 阶段 A（先体验）
- 重构配对页面信息架构与交互流程。
- 建立“扫码/相册、粘贴链接、手动配对码”三入口闭环。
- 统一失败弹窗与建议动作映射。

2. 阶段 B（再安全）
- 继续强化 `pairTicket` 路径（过期、重放、风控提示）。
- 将移动端敏感信息从 `localStorage` 升级到 iOS Keychain。
- 已落地“设备级会话凭证”（`accessToken + refreshToken + PoP`）并替代长期 `pairToken` 作为默认连接凭证。
- 后续收口为仅保留 sidecar 侧 `pairToken`，关闭 App 直传 `pairToken`。

## 6. 相关文档

1. `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/01-用户流程与页面交互-v1.md`
2. `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/02-协议与安全方案-v1.md`
3. `/Users/codez/develop/yourConnector/docs/配对与宿主机接入/03-实施计划与验收-v1.md`
