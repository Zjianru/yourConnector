# yourConnector 配对与宿主机接入：用户流程与页面交互

## 1. 页面结构

### 1.1 首次配对页

触发条件：当前无已配对宿主机。

入口：

1. 导入配对链接（扫码/图库/粘贴链接）。
2. 手动填写配对信息（Relay + sid + ticket）。
3. 调试入口（开发态）。

### 1.2 多宿主总览页

触发条件：存在至少一台已配对宿主机。

布局：

1. `Host Snapshot` Banner + 白点索引。
2. `Connected Tools` 按宿主机分组。
3. 工具卡片支持左滑操作（编辑名称 / 删除接入 / 进程控制）。

### 1.3 宿主管理页

入口：顶部“更换宿主机”。

能力：

1. 连接/断开。
2. 编辑名称与备注。
3. 重新配对。
4. 删除与补偿重试。
5. 添加宿主机。

## 2. 配对流程

### 2.1 链接导入流程

1. 扫码或粘贴 `yc://pair?...`。
2. 解析 `relay/sid/ticket`。
3. 执行 `preflight -> exchange`。
4. 写入设备会话并连接宿主机。

### 2.2 手动输入流程

1. 输入 `Relay WS URL`。
2. 输入 `sid` 与 `pairTicket`。
3. 提交后执行 `preflight -> exchange`。

### 2.3 统一失败反馈

失败弹窗统一展示：

1. 失败原因。
2. 建议动作。
3. 主按钮（重试/改走手动/重新扫码）。

## 3. 多宿主行为

1. 宿主机支持并行在线。
2. 启动后自动连接所有已配对宿主机。
3. 断线按固定重连策略执行，超限后提示手动重连。
4. 宿主顺序按 `pairedAt` 升序。

## 4. 删除与补偿

1. Relay 可达且吊销成功：立即删除。
2. Relay 不可达或失败：先隐藏并进入补偿队列。
3. 后台持续重试，成功后清理本地会话与配置。

## 5. 开发态调试

1. `xcrun simctl openurl booted "yc://pair?..."` 可模拟扫码。
2. `make simulate-ios-scan` 封装了模拟器投递链路。
3. 建议回归四条路径：扫码、图库、粘贴、手动。
