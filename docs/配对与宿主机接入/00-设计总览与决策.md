# yourConnector 配对与宿主机接入：设计总览与决策

## 1. 问题背景

在 Relay 场景下，配对不仅是交互入口，更是授权边界。系统需要同时满足：

1. 首次接入路径清晰。
2. 凭证链路可轮换、可吊销。
3. 多宿主并行在线不互相污染。

## 2. 核心决策

1. 配对签发同源：所有配对链接均由 Relay `/v1/pair/bootstrap` 统一签发。
2. App 安全收口：App 不再接受 `pairToken` 直连，仅接受 `pairTicket` + 设备凭证。
3. Sidecar 边界保留：`pairToken` 仅用于 sidecar 与 relay 的内部握手。
4. 凭证分层：配对后换发 `accessToken + refreshToken + PoP`，并支持刷新与吊销。
5. 失败可恢复：配对失败统一错误码与建议动作，避免黑盒失败。

## 3. 交互决策

1. 首屏按是否存在宿主机展示配对入口或总览页。
2. 配对入口保留三条路径：扫码/图库、链接导入、手动输入。
3. 配对成功后立即进入连接态，不再要求二次确认。
4. 多宿主管理与删除补偿由管理页统一承接。

## 4. 安全决策

1. `pairTicket` 为短时票据（可配置 TTL，默认 300 秒）。
2. 票据校验包含签名、时效、nonce 防重放。
3. WS 鉴权采用 PoP 请求签名，阻断 token 裸用重放。
4. 本地敏感会话凭证仅存安全存储（Keychain/等效实现）。

## 5. 相关文档

1. `docs/配对与宿主机接入/01-用户流程与页面交互.md`
2. `docs/配对与宿主机接入/02-协议与安全方案.md`
3. `docs/配对与宿主机接入/03-实施计划与验收.md`
