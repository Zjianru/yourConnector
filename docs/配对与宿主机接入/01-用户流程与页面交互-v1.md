# yourConnector 配对与宿主机接入：用户流程与页面交互 v1

## 1. 页面结构

### 1.1 页面 A：首次配对页

触发条件：当前没有任何已配对宿主机。

入口与动作：

1. 导入配对链接（进入导入流程）
2. 手动填写配对信息（进入手动流程）
3. 调试入口（仅开发态）

### 1.2 页面 B：多宿主总览页

触发条件：存在至少一台已配对宿主机。

布局：

1. 顶部 `Host Snapshot` 使用横向 Banner 卡片展示宿主机。
2. Banner 下方展示白点指示当前滑动索引。
3. 下方 `Connected Tools` 按宿主机分组展示。

交互规则：

1. Banner 仅用于滑动浏览与索引提示，不承载点击动作。
2. 每个分组都展示该宿主机工具列表；空分组展示空态文案。
3. 已接入工具卡片支持左滑，显示“编辑名称 / 删除接入”两个操作。

### 1.3 页面 C：宿主机管理页

入口：顶部 `更换宿主机` 按钮。

能力：

1. 查看已配对宿主机列表（状态、备注）。
2. 对单台宿主机执行：连接、断开、编辑、重新配对、删除。
3. 查看删除补偿队列并支持手动重试。
4. 添加宿主机入口。

### 1.4 页面 D：宿主机编辑页

可编辑字段：

1. 宿主机名称
2. 备注

不可编辑字段：

1. systemId
2. Relay 地址
3. 认证凭证

## 2. 配对流程

### 2.1 导入流程

1. 扫码/图库导入二维码。
2. 粘贴 `yc://pair?...` 配对链接。
3. 二维码/链接由 relay 统一签发（`/v1/pair/bootstrap`）。
4. 成功后立即完成 `preflight -> exchange` 并保存设备凭证。

### 2.2 手动流程

1. 输入 `Relay WS URL`。
2. 输入 `System ID（sid）` 与 `pairTicket`。
3. 可输入宿主机名称。
4. 提交后执行 `preflight -> exchange`。

### 2.3 统一失败弹窗

所有入口失败都统一展示：

1. 失败原因
2. 建议下一步
3. 主操作按钮（重试/去手动/重新扫码）

## 3. 多宿主与排序

1. 宿主机支持并行在线。
2. 宿主机展示顺序按认证时间 `pairedAt` 升序。
3. 重新配对不改变原 `pairedAt`。
4. 删除后重加视为新认证，排到末尾。

## 4. 重名提示

1. 新增或恢复宿主机时若名称重名，立即弹出提示。
2. 提示仅用于引导改名，不阻断当前连接与配对。
3. 宿主机唯一身份仍由 `hostId/systemId/relayUrl` 决定。

## 5. 删除与最终一致性

1. 用户点击删除后，若 Relay 可达且吊销成功：立即彻底删除。
2. Relay 不可达或吊销失败：
- 页面先隐藏该宿主机。
- 写入删除补偿队列。
- 后续自动重试，直到删除完成。
3. 管理页需显示“删除处理中”状态和手动重试入口。

## 6. 并行在线与重连

1. 启动 App 后自动连接全部已配对宿主机。
2. 连接后依赖 heartbeat 判断在线状态。
3. 任一宿主机断线后按 2 秒间隔重连。
4. 连续失败 5 次后停止自动重连，并提示手动重连。

## 7. 开发态扫码调试

1. 可通过 `xcrun simctl openurl booted "yc://pair?..."` 模拟扫码结果。
2. 需验证扫码、图库、粘贴、手动四条路径。
3. iOS 权限需允许相机与相册读取。
